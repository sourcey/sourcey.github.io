<!doctype html> <html class=no-js lang=en> <head> <title>LibSourcey Event-driven Networking with Libuv</title> <meta charset=utf-8 /> <meta name=viewport content="width=device-width, initial-scale=1.0"/> <meta name=google-site-verification content=lC7-hHwqtiRqo7YTHc1fJ6t8ie-Hs7J4o5u3XRIF9Vw /> <link rel=alternate type="application/atom+xml" title="Atom Feed" href="/feed.xml"/> <link href="/stylesheets/app.css" media=screen rel=stylesheet /> <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-836728-7', 'sourcey.com');
      ga('send', 'pageview');
    </script> </head> <body class="article libsourcey-event-driven-networking-with-libuv libsourcey-event-driven-networking-with-libuv_index"> <nav class=top-bar data-topbar=""> <div class=top-bar-inner> <div id=social> <a href="https://plus.google.com/+SourceyDevel"><i class="fi-social-google-plus large"></i></a> <a href="https://facebook.com/sourceydevel"><i class="fi-social-facebook large"></i></a> <a href="https://twitter.com/sourceydevel"><i class="fi-social-twitter large"></i></a> <a href="https://github.com/sourcey"><i class="fi-social-github large"></i></a> </div> <ul class=title-area> <li class=name></li> <li class="toggle-topbar menu-icon"><a href="" class=left></a></li> </ul> <section class=top-bar-section style="left: 0%;"> <ul class=left> <li class=home><a href="/">Home</a></li> <li class=has-dropdown><a href="/#projects">Projects</a> <ul class=dropdown><li class="title back js-generated"><h5><a href="javascript:void(0)">Back</a></h5></li> <li> <a href="/libsourcey"><b>LibSourcey</b><small>C++ networking evolved</small></a> </li> <li> <a href="/anionu"><b>Anionu</b><small>Cloud video surveillance</small></a> </li> <li> <a href="//stompstart.com"><b>StompStart</b><small>Promote your startup</small></a> </li> <li> <a href="/symple"><b>Symple</b><small>Messaging made Symple</small></a> </li> <li> <a href="/mesh"><b>Mesh</b><small>Elegant, modern design</small></a> </li> <li> <a href="/pacm"><b>Pacm</b><small>Redistributable package manager</small></a> </li> <li> <a href="/pluga"><b>Pluga</b><small>C++ plugin system</small></a> </li> </ul> </li> <li class=has-dropdown><a href="/#articles">Articles</a> <ul class=dropdown> <li><a href="/archives">Archives</a></li> <li><a href="/feed.xml">Feed</a></li> </ul> </li> <li><a href="mailto:hello@sourcey.com">Contact</a></li> <li class=divider></li> </ul> </section> </div> </nav> <header id=header> <h1 id=logo> <a title=Sourcey rel=home href="//sourcey.com"><img height=150 width=150 title=Sourcey alt=Sourcey src="/images/logos/sourcey-glow-250x250.png"/></a> </h1> </header> <div id=main role=main> <article> <header class=article-header> <h1>LibSourcey Event-driven Networking with Libuv</h1> <div class=meta> By <a rel="author external" href="https://plus.google.com/+KamLow">Kam Low</a> &diams; <time class=updated datetime="Feb 10 2014">Feb 10 2014</time> </div> </header> <div class="article-wrap row"> <div class="large-9 columns"> <div class=content> <!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd"> <html><body> <p><img alt="LibSourcey Logo" title="LibSourcey Logo" class=align-left src="/images/logos/libsourcey-120x120.png"> <a href="//sourcey.com/libsourcey" title="C++ Networking Evolved" target=_blank>LibSourcey</a> began it’s life built on the brilliant <a href="//pocoproject.org/">Poco C++ libraries</a>, but once we began developing mission critical server-side code like our <a href="https://tools.ietf.org/html/rfc5245" title="Interactive Connectivity Establishment" target=_blank>ICE </a>stack (TURN/STUN server), HTTP server and <a href="//sourcey.com/symple" title="Messaging Made Symple" target=_blank>Symple</a> messaging, the old multi-thread design just wouldn’t cut it.</p> <p>Poco is a well designed and cleanly coded C++ library with cross-platform implementations for just about everything you would ever need to build most console applications, but it’s not without it’s niggles:</p> <ul> <li>Poco clearly isn’t meant for high-performance networking, which is evident in the thread-per-connection model used in the HTTP stack. </li> <li>Overuse or private methods and members which make it almost impossible to extend and override even the most basic functionality. </li> </ul> <p>Performance issues aside, some things about Poco just didn’t seem as open or intuitive as they could be, which is why we turned to libuv and C++11.</p> <p>Most developers know about <a href="//nodejs.org/" title=NodeJS target=_blank>Node.js</a>, which is a runtime that makes it a sinch to quickly and easily deploy high performance networking applications in the cloud using good ol’ JavaScript. The underlying library which powers Node.js’s cross-platform event-driven awesomeness is of course <a href="https://github.com/joyent/libuv" title="Cross-platform asychronous I/O">libuv</a>, and now it powers LibSourcey too.</p> <p>The great thing about working with libuv is that it’s event-based rather than thread-based, so rather than relying on threads for asynchronicity, the event loop is used instead. From a performance standpoint the thread-per-core model is ideal for evented IO, that is; one event loop, per thread, per CPU core. This is by no means a hard and fast rule, since the use of threads is still appropriate for long blocking tasks, although it’s definitely something to aspire towards when writing your code.</p> <p>Since the event loop runs in a single thread very little synchronization is required, other than to pass data between threads which is sometimes unavoidable (such as when using a load balancer). By refactoring the LibSourcey codebase to use an event-based architecture we were able to decrease the use of synchronization primitives by 90%.</p> <p>Event-driven programming has helped us write better code and yield massive performance gains, especially for networking applications. If you want to save your sanity then stop writing multi-threaded code - your code will be better, faster, and easier to debug. There’s a lot more to talk about here, but that’s a song for another day.</p> </body></html> </div> </div> <div class="large-3 columns"> <div class=sidebar> <div class="sidebar-section tags"> <h4>Tags</h4> <ul><li><a href="/tags/cpp/">Cpp</a></li><li><a href="/tags/libsourcey/">LibSourcey</a></li><li><a href="/tags/libuv/">Libuv</a></li><li><a href="/tags/performance/">Performance</a></li></ul> </div> </div> </div> <ul class=social-buttons> <li> <a href="//twitter.com/share" class="socialite twitter-share" data-text="LibSourcey Event-driven Networking with Libuv" data-url="http://sourcey.com/libsourcey-event-driven-networking-with-libuv/" data-count=vertical rel=nofollow target=_blank><span class=vhidden>Share on Twitter</span></a> </li> <li> <a href="https://plus.google.com/share?url=http://sourcey.com/libsourcey-event-driven-networking-with-libuv/" class="socialite googleplus-one" data-size=tall data-href="//sourcey.com/libsourcey-event-driven-networking-with-libuv/" rel=nofollow target=_blank><span class=vhidden>Share on Google+</span></a> </li> <li> <a href="//www.facebook.com/sharer.php?u=http://sourcey.com/libsourcey-event-driven-networking-with-libuv/&amp;t=LibSourcey Event-driven Networking with Libuv" class="socialite facebook-like" data-href="http://sourcey.com/libsourcey-event-driven-networking-with-libuv/" data-send=false data-layout=box_count data-width=60 data-show-faces=false rel=nofollow target=_blank><span class=vhidden>Share on Facebook</span></a> </li> <li> <a href="//www.linkedin.com/shareArticle?mini=true&amp;url=http://sourcey.com/libsourcey-event-driven-networking-with-libuv/&amp;title=LibSourcey Event-driven Networking with Libuv" class="socialite linkedin-share" data-url="http://sourcey.com/libsourcey-event-driven-networking-with-libuv/" data-counter=top rel=nofollow target=_blank><span class=vhidden>Share on LinkedIn</span></a> </li> </ul> <article> <div id=disqus_thread></div> <script>
          /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
          var disqus_shortname = 'sourcey'; // required: replace example with your forum shortname

          /* * * DON'T EDIT BELOW THIS LINE * * */
          (function() {
              var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
              dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
              (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
          })();
      </script> <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript" rel=nofollow>comments powered by Disqus.</a></noscript> <a href="//disqus.com" rel=nofollow class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a> </div> <footer id=footer> <p> As with all business minded artists, we have fought the inevitable battle of conformity vs expression, and have emerged victorious with sanity intact to plunder the digiverse in search of new and interesting challenges. For more information, or a quote, drop us an email and tell us what you're working on. </p> <p> &copy;2014 Sourcey <p> </footer> </body> </html> <script src="/javascripts/all.js"></script>