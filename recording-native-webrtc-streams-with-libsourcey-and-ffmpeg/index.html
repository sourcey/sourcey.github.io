<!doctype html> <html class=no-js lang=en> <head> <title>Recording Native WebRTC Streams with LibSourcey and FFmpeg | Sourcey</title> <meta charset=utf-8 /> <meta name=viewport content="width=device-width, initial-scale=1.0"/> <meta name=google-site-verification content=lC7-hHwqtiRqo7YTHc1fJ6t8ie-Hs7J4o5u3XRIF9Vw /> <link rel=alternate type="application/atom+xml" title="Atom Feed" href="/feed.xml"/> <link href="/stylesheets/app.css" media=screen rel=stylesheet /> <script src="/javascripts/all.js"></script> <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script> <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-836728-7', 'sourcey.com');
      ga('send', 'pageview');
    </script> </head> <body class="article recording-native-webrtc-streams-with-libsourcey-and-ffmpeg recording-native-webrtc-streams-with-libsourcey-and-ffmpeg_index"> <nav class=top-bar data-topbar=""> <div class=top-bar-inner> <div id=social> <a href="https://github.com/sourcey"><i class=fi-social-github></i></a> <a href="https://twitter.com/sourceydevel"><i class=fi-social-twitter></i></a> <a href="https://plus.google.com/+SourceyDevel"><i class=fi-social-google-plus></i></a> <a href="https://facebook.com/sourceydevel"><i class=fi-social-facebook></i></a> </div> <ul class=title-area> <li class=name></li> <li class="toggle-topbar menu-icon"><a href="#" class=left></a></li> </ul> <section class=top-bar-section style="left: 0%;"> <ul class=left> <li class=home><a href="/">Home</a></li> <li class=has-dropdown><a href="/#projects">Projects</a> <ul class=dropdown><li class="title back js-generated"><h5><a href="javascript:void(0)">Back</a></h5></li> <li> <a href="/libsourcey"><b>LibSourcey</b><small>C++ networking evolved</small></a> </li> <li> <a href="/anionu"><b>Anionu</b><small>Cloud video surveillance</small></a> </li> <li> <a href="http://stompstart.com"><b>StompStart</b><small>Promote your startup</small></a> </li> <li> <a href="/symple"><b>Symple</b><small>Messaging made Symple</small></a> </li> <li> <a href="/mesh"><b>Mesh</b><small>Elegant, modern design</small></a> </li> <li> <a href="/pacm"><b>Pacm</b><small>Redistributable package manager</small></a> </li> <li> <a href="/pluga"><b>Pluga</b><small>C++ plugin system</small></a> </li> <li> <a href="http://avidsense.com"><b>Avid Sense</b><small>Freedom of expression</small></a> </li> <li> <a href="/recliner"><b>Recliner.js</b><small>Flexible lazy loading</small></a> </li> </ul> </li> <li class=has-dropdown><a href="/#articles">Articles</a> <ul class=dropdown> <li><a href="/archives">Archives</a></li> <li><a href="/feed.xml">Feed</a></li> </ul> </li> <li><a href="mailto:hello@sourcey.com">Contact</a></li> <li class=divider></li> </ul> </section> </div> </nav> <div id=main role=main> <article> <header class=article-header> <h1>Recording Native WebRTC Streams with LibSourcey and FFmpeg</h1> <div class=meta> <a rel="author external" class=author href="https://plus.google.com/+KamLow">Kam Low</a> &mdash; <time class=updated datetime="Oct 31 2016">Oct 31 2016</time> <div class=tags> <a href="/tags/code/">Code</a>, <a href="/tags/c/">C++</a>, <a href="/tags/webrtc/">WebRTC</a>, <a href="/tags/libsourcey/">LibSourcey</a>, <a href="/tags/ffmpeg/">FFmpeg</a> </div> </div> </header> <div class="article-wrap row"> <div class="large-8 columns"> <div class=content> <!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd"> <html><body> <p>The <a href="https://developer.mozilla.org/en-US/docs/Web/API/MediaStream_Recording_API">MediaStream Recording API</a> lets us record WebRTC streams in the browser, but what about recording a live WebRTC stream in a native app or on the server side? <a href="/libsourcey">LibSourcey</a> has a new WebRTC module available that lets you do exactly that.</p> <p>Before going into details the full open source <a href="https://github.com/sourcey/libsourcey/tree/master/src/webrtc/samples/webrtcrecorder">demo code is here</a>.</p> <h2 id=how-it-works>How it Works</h2> <p>Basically, the server operates as a standard WebRTC peer, so you connect to it from the browser (or another native app) as you would normally by initiating a <code>RTCPeerConnection</code>, and the server reads any media sent from the peer and encodes it in realtime using FFmpeg.</p> <p>WebRTC signaling happens courtesy of <a href="/symple">Symple</a>, our propose built messaging protocol for scalable high speed native to browser communications.</p> <p>For those of you familiar with the native WebRTC C++ codebase, what we are doing is overriding the <code>rtc::VideoSinkInterface&lt;cricket::VideoFrame&gt;</code> and <code>public webrtc::AudioTrackSinkInterface</code> in order to capture audio and video packets from the incoming <code>webrtc::MediaStream</code>. The <code>scy::av::MultiplexEncoder</code> then works with FFmpeg under the hood to encode and multiplex the live streams into the output file/stream.</p> <p>The main WebRTC StreamRecorder class is <a href="https://github.com/sourcey/libsourcey/blob/master/src/webrtc/samples/webrtcrecorder/streamrecorder.cpp">here</a>.</p> <h2 id=using-the-code>Using the Code</h2> <p>To get started compile LibSourcey with FFmpeg and WebRTC, and samples enabled. The <code>webrtcrecorder</code> binary will be compiled and you can test it with the provided client code (you will need Nodejs installed).</p> <p>Please refer to the <a href="https://github.com/sourcey/libsourcey/blob/master/src/webrtc/samples/webrtcrecorder/README.md">README</a> in the <code>webrtcrecorder</code> sample directory for more information.</p> <p>If you find this code useful or end up using it in a real world scenario please share your thoughts and experience with others in the comments below.</p> <p>All contributions to the codebase are welcome, and we hope to continue to improve our WebRTC integrations over time. Good luck and happy coding!</p> </body></html> </div> </div> <div class="large-4 columns"> <div class=sidebar> <div class="sidebar-section toc"> <h4 class=no_toc id=contents>Contents</h4> <ul id=markdown-toc> <li><a id=markdown-toc-how-it-works href="#how-it-works">How it Works</a></li> <li><a id=markdown-toc-using-the-code href="#using-the-code">Using the Code</a></li> </ul> </div> <div class="sidebar-section ad ad-300x250 sidebar-float"> <ins class=adsbygoogle style="display:inline-block;width:300px;height:600px" data-ad-client=ca-pub-1397369873900370 data-ad-slot=7510590887></ins> <script>
                (adsbygoogle = window.adsbygoogle || []).push({});
                </script> </div> </div> </div> </article> <div class=row> <div class=social-buttons> <ul> <li> <a href="http://twitter.com/share" class="socialite twitter-share" data-text="Recording Native WebRTC Streams with LibSourcey and FFmpeg" data-url="http://sourcey.com/recording-native-webrtc-streams-with-libsourcey-and-ffmpeg/" data-count=vertical rel=nofollow target=_blank><span class=vhidden>Share on Twitter</span></a> </li> <li> <a href="https://plus.google.com/share?url=http://sourcey.com/recording-native-webrtc-streams-with-libsourcey-and-ffmpeg/" class="socialite googleplus-one" data-size=tall data-href="http://sourcey.com/recording-native-webrtc-streams-with-libsourcey-and-ffmpeg/" rel=nofollow target=_blank><span class=vhidden>Share on Google+</span></a> </li> <li> <a href="http://www.facebook.com/sharer.php?u=http://sourcey.com/recording-native-webrtc-streams-with-libsourcey-and-ffmpeg/&amp;t=Recording Native WebRTC Streams with LibSourcey and FFmpeg" class="socialite facebook-like" data-href="http://sourcey.com/recording-native-webrtc-streams-with-libsourcey-and-ffmpeg/" data-send=false data-layout=box_count data-width=60 data-show-faces=false rel=nofollow target=_blank><span class=vhidden>Share on Facebook</span></a> </li> <li> <a href="http://www.linkedin.com/shareArticle?mini=true&amp;url=http://sourcey.com/recording-native-webrtc-streams-with-libsourcey-and-ffmpeg/&amp;title=Recording Native WebRTC Streams with LibSourcey and FFmpeg" class="socialite linkedin-share" data-url="http://sourcey.com/recording-native-webrtc-streams-with-libsourcey-and-ffmpeg/" data-counter=top rel=nofollow target=_blank><span class=vhidden>Share on LinkedIn</span></a> </li> </ul> </div> </div> <div id=disqus_thread></div> <script>
          /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
          var disqus_shortname = 'sourcey'; // required: replace example with your forum shortname

          /* * * DON'T EDIT BELOW THIS LINE * * */
          (function() {
              var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
              dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
              (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
          })();
      </script> <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript" rel=nofollow>comments powered by Disqus.</a></noscript> <a href="http://disqus.com" rel=nofollow class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a> </div> <footer id=footer> <div class="row show-for-large-up"> <div class="ad ad-720x90 text-center"> <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script> <ins class=adsbygoogle style="display:inline-block;width:728px;height:90px" data-ad-client=ca-pub-1397369873900370 data-ad-slot=8042301285></ins> <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
          </script> </div> </div> <p> As with all business minded artists, we have fought the inevitable battle of conformity vs expression, and have emerged victorious with sanity intact to plunder the digiverse in search of new and interesting challenges. For more information, or a quote, drop us an email and tell us what you're working on. </p> <p>&copy; 2016 Sourcey<p> </footer> </body> </html>